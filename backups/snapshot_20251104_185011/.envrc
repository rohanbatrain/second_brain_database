# --- direnv + nix + python setup ---
# Prefer local flake for speed and iteration
CANDIDATES=(
  "$HOME/Documents/nix-config#python"
  "github:rohanbatrain/nix-config/a9cfc73bb234f92fe4f669b51d1c45f400cc43e6#python"
  "github:rohanbatrain/nix-config#python"
)

use_flake_found=false

for c in "${CANDIDATES[@]}"; do
  if use flake "$c"; then
    use_flake_found=true
    break
  fi
done

if [ "$use_flake_found" = false ]; then
  echo "direnv: warning — no usable devShell found among candidates" >&2
  # fallback to python venv
  if [ -f "pyproject.toml" ]; then
    if [ ! -d ".venv" ]; then
      echo "direnv: creating .venv environment..."
      python3 -m venv .venv
    fi
    source .venv/bin/activate
  fi
else
  # ✅ ensure uv-installed tools like uvicorn are visible
  if [ -d ".venv/bin" ]; then
    export PATH="$(pwd)/.venv/bin:$PATH"
    echo "direnv: added .venv/bin to PATH"
    
  fi
fi

